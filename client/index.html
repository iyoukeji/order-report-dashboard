<!doctype html>
<html lang="en" ng-app>
  <head>
    <title>订单地图</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
      body, html{
        width: 100%;height: 100%;margin:0;font-family:"微软雅黑";
      }
		  #l-map{
		    height:100%;width:100%;
		  }
    </style>
  </head>
  <body>
    <div id="l-map"></div>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/js/jquery.min.js"></script>
    <script type="text/javascript" src="/js/audio.js"></script>
    <script type="text/javascript" src="/js/nosleep.js"></script>
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&amp;ak=DaqrOr0QQjstFxvQzc0ECGGE"></script>
    <script type="text/javascript">
      $(function ($) {
        (new NoSleep()).enable();
        var map = new BMap.Map("l-map");
      	map.centerAndZoom(new BMap.Point(121.593943, 38.902064), 13);
      	map.enableScrollWheelZoom(true);
      	map.addControl(new BMap.NavigationControl());
      	var myGeo = new BMap.Geocoder();
        var socket = io.connect();
        socket.on('message', function (msg) {
          myGeo.getPoint(msg.address.text, function (point) {
        	  if (point) {
        	    var address = new BMap.Point(point.lng, point.lat);
        	    var marker = new BMap.Marker(point);
  		        map.addOverlay(marker);
  		        marker.setLabel(new BMap.Label(msg.title + '<br />' 
  		          + '订单量：' + msg.amount + '升' + '<br />' 
    		        + '送达时间：' + msg.arriveAt.date + ' ' + msg.arriveAt.time + '<br />' 
    		        + '详细地址：' + msg.address.text, { offset: new BMap.Size(20, -10), background: '#5cb85c' }));
  		        map.centerAndZoom(address, 13);
  		        require('browser-audio').create('/asset/chongfenghao.mp3').play();
        	  }
        	}, "大连市");
        });
      });
    </script>
  </body>
</html>
